service: AmazonEKS
version: "2.0.0"

inputs:
  - name: cluster_count
    type: integer
    required: true
    default: 1
    description: "Number of EKS clusters"
  - name: node_group_type
    type: string
    required: true
    default: "Fargate"
    description: "Node group type (EC2, Fargate, or Both)"
  - name: fargate_vcpu_hours
    type: number
    required: false
    default: 0
    description: "Fargate vCPU hours per month"
  - name: fargate_gb_hours
    type: number
    required: false
    default: 0
    description: "Fargate GB memory hours per month"

calculation_steps:
  - id: cluster_cost
    description: "EKS cluster cost"
    formula: "cluster_count * pricing.cluster.per_hour * pricing.constants.hours_per_month"
    output: cluster_cost
    pricing_keys:
      - cluster.per_hour
      - constants.hours_per_month
      
  - id: fargate_vcpu_cost
    description: "Fargate vCPU cost"
    formula: |
      if node_group_type in ['Fargate', 'Both']:
        fargate_vcpu_hours * pricing.fargate.per_vcpu_hour
      else:
        0
    output: vcpu_cost
    pricing_keys:
      - fargate.per_vcpu_hour
      
  - id: fargate_memory_cost
    description: "Fargate memory cost"
    formula: |
      if node_group_type in ['Fargate', 'Both']:
        fargate_gb_hours * pricing.fargate.per_gb_hour
      else:
        0
    output: memory_cost
    pricing_keys:
      - fargate.per_gb_hour

total_formula: "cluster_cost + vcpu_cost + memory_cost"

assumptions:
  - "EKS cluster pricing varies by region"
  - "Fargate pricing varies by region"
  - "EC2 nodes: pay for EC2 instances separately"
  - "Worker node costs not included in this calculation"

pricing_sources:
  - name: "Amazon EKS Pricing"
    url: "https://aws.amazon.com/eks/pricing/"
    last_updated: "2024-12-15"
