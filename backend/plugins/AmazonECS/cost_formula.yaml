service: AmazonECS
version: "2.0.0"

inputs:
  - name: launch_type
    type: string
    required: true
    default: "Fargate"
    description: "Launch type (Fargate or EC2)"
  - name: vcpu_hours_per_month
    type: number
    required: true
    default: 730
    description: "vCPU hours per month"
  - name: gb_hours_per_month
    type: number
    required: true
    default: 1460
    description: "GB memory hours per month"
  - name: storage_gb
    type: number
    required: false
    default: 20
    description: "Ephemeral storage (GB)"

calculation_steps:
  - id: fargate_vcpu_cost
    description: "Fargate vCPU cost"
    formula: |
      if launch_type == 'Fargate':
        vcpu_hours_per_month * pricing.fargate.per_vcpu_hour
      else:
        0
    output: vcpu_cost
    pricing_keys:
      - fargate.per_vcpu_hour
      
  - id: fargate_memory_cost
    description: "Fargate memory cost"
    formula: |
      if launch_type == 'Fargate':
        gb_hours_per_month * pricing.fargate.per_gb_hour
      else:
        0
    output: memory_cost
    pricing_keys:
      - fargate.per_gb_hour
      
  - id: storage_cost
    description: "Ephemeral storage cost (beyond included 20GB)"
    formula: |
      if launch_type == 'Fargate' and storage_gb > 20:
        (storage_gb - 20) * pricing.fargate.storage_per_gb_hour * pricing.constants.hours_per_month
      else:
        0
    output: storage_cost
    pricing_keys:
      - fargate.storage_per_gb_hour
      - constants.hours_per_month

total_formula: "vcpu_cost + memory_cost + storage_cost"

assumptions:
  - "Fargate pricing varies by region"
  - "20GB ephemeral storage included in Fargate"
  - "EC2 launch type: no ECS charges (pay for EC2 instances)"
  - "Fargate Spot pricing not included (70% discount available)"

pricing_sources:
  - name: "Amazon ECS Pricing"
    url: "https://aws.amazon.com/ecs/pricing/"
    last_updated: "2024-12-15"
