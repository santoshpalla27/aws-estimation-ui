service: AmazonEC2
formula_version: "1.0.0"

inputs:
  - name: instance_type
    type: string
    required: true
    description: "EC2 instance type (e.g., 'm5.large')"
  
  - name: instance_count
    type: integer
    required: false
    default: 1
    validation:
      min: 1
      max: 1000
  
  - name: operating_system
    type: enum
    enum_values: [Linux, Windows, RHEL, SUSE]
    default: Linux
  
  - name: ebs_volumes
    type: array
    required: false
    default: []
  
  - name: estimated_monthly_egress_gb
    type: float
    required: false
    default: 100.0
    description: "Estimated monthly data transfer out"

calculation_steps:
  - step_id: base_instance_cost
    formula: (0.096 if instance_type == "t3.micro" else 0.0104 if instance_type == "t3.nano" else 0.192 if instance_type == "t3.small" else 0.384 if instance_type == "t3.medium" else 0.768 if instance_type == "t3.large" else 0.096 if instance_type == "m5.large" else 0.192 if instance_type == "m5.xlarge" else 0.384 if instance_type == "m5.2xlarge" else 0.096) * 730 * instance_count
    description: "Base EC2 instance cost (on-demand, 24/7, Linux)"
    unit: USD
  
  - step_id: ebs_storage_cost
    formula: 0
    description: "EBS volume storage cost (simplified - $0 for now)"
    unit: USD
  
  - step_id: data_transfer_out
    formula: (estimated_monthly_egress_gb - 100) * 0.09 if estimated_monthly_egress_gb > 100 else 0
    description: "Data transfer out cost (first 100GB free)"
    unit: USD

total_formula: base_instance_cost + ebs_storage_cost + data_transfer_out

assumptions:
  - "730 hours per month (24/7 operation)"
  - "On-demand pricing (no Reserved Instances or Savings Plans)"
  - "Data transfer within same region unless CloudFront is used"
