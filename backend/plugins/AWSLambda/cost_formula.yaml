service: AWSLambda
version: "1.0.0"

inputs:
  - name: memory_mb
    type: integer
    required: true
    description: "Memory allocation in MB (128-10240)"
    
  - name: avg_duration_ms
    type: integer
    required: true
    description: "Average execution duration in milliseconds"
    
  - name: monthly_invocations
    type: integer
    required: true
    description: "Number of function invocations per month"
    
  - name: architecture
    type: string
    required: false
    default: "x86_64"
    description: "Processor architecture (x86_64 or arm64)"
    
  - name: ephemeral_storage_mb
    type: integer
    required: false
    default: 512
    description: "Ephemeral storage in MB (512-10240)"

calculation_steps:
  - id: compute_gb_seconds
    description: "Calculate GB-seconds of compute time"
    formula: (memory_mb / 1024) * (avg_duration_ms / 1000) * monthly_invocations
    output: compute_gb_seconds
    
  - id: billable_gb_seconds
    description: "Compute GB-seconds after free tier (400,000 GB-seconds free)"
    formula: compute_gb_seconds - 400000 if compute_gb_seconds > 400000 else 0
    output: billable_compute
    
  - id: compute_cost
    description: "Cost for compute time ($0.0000166667 per GB-second)"
    formula: billable_compute * 0.0000166667
    output: compute_cost
    
  - id: billable_requests
    description: "Requests after free tier (1M requests free)"
    formula: monthly_invocations - 1000000 if monthly_invocations > 1000000 else 0
    output: billable_requests
    
  - id: request_cost
    description: "Cost for requests ($0.20 per 1M requests)"
    formula: (billable_requests / 1000000) * 0.20
    output: request_cost
    
  - id: ephemeral_storage_cost
    description: "Cost for additional ephemeral storage"
    formula: ((ephemeral_storage_mb - 512) / 1024) * compute_gb_seconds * 0.0000000309 if ephemeral_storage_mb > 512 else 0
    output: storage_cost

total_formula: compute_cost + request_cost + storage_cost

assumptions:
  - "AWS Free Tier applies (400,000 GB-seconds and 1M requests per month)"
  - "No provisioned concurrency configured"
  - "Standard Lambda pricing (not Lambda@Edge)"
  - "Average duration used for all invocations"
  - "x86_64 architecture pricing (arm64 is 20% cheaper)"

pricing_sources:
  - name: "AWS Lambda Pricing"
    url: "https://aws.amazon.com/lambda/pricing/"
    last_updated: "2024-01-01"
