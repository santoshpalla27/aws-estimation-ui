service: AmazonS3
version: "1.0.0"

inputs:
  - name: storage_gb
    type: number
    required: true
    description: "Total storage in GB"
    
  - name: storage_class
    type: string
    required: true
    description: "S3 storage class"
    
  - name: put_requests_per_month
    type: integer
    required: true
    description: "Number of PUT/POST requests per month"
    
  - name: get_requests_per_month
    type: integer
    required: true
    description: "Number of GET requests per month"
    
  - name: data_transfer_gb
    type: number
    required: false
    default: 0
    description: "Data transfer out to internet (GB/month)"

calculation_steps:
  - id: storage_cost
    description: "Storage cost based on storage class"
    formula: >
      storage_gb * (
        pricing.storage.standard if storage_class == "STANDARD" else
        pricing.storage.intelligent_tiering if storage_class == "INTELLIGENT_TIERING" else
        pricing.storage.standard_ia if storage_class == "STANDARD_IA" else
        pricing.storage.onezone_ia if storage_class == "ONEZONE_IA" else
        pricing.storage.glacier_instant if storage_class == "GLACIER_INSTANT" else
        pricing.storage.glacier_flexible if storage_class == "GLACIER_FLEXIBLE" else
        pricing.storage.glacier_deep_archive if storage_class == "GLACIER_DEEP_ARCHIVE" else
        pricing.storage.standard
      )
    output: storage_cost
    pricing_keys:
      - storage.standard
      - storage.intelligent_tiering
      - storage.standard_ia
      - storage.onezone_ia
      - storage.glacier_instant
      - storage.glacier_flexible
      - storage.glacier_deep_archive
    
  - id: put_request_cost
    description: "PUT/POST request costs"
    formula: (put_requests_per_month / 1000) * pricing.requests.put_per_1000
    output: put_cost
    pricing_keys:
      - requests.put_per_1000
    
  - id: get_request_cost
    description: "GET request costs"
    formula: (get_requests_per_month / 1000) * pricing.requests.get_per_1000
    output: get_cost
    pricing_keys:
      - requests.get_per_1000
    
  - id: data_transfer_cost
    description: "Data transfer out to internet (tiered pricing)"
    formula: >
      0 if data_transfer_gb <= pricing.data_transfer.free_tier_gb else
      (data_transfer_gb - pricing.data_transfer.free_tier_gb) * pricing.data_transfer.tier_1_per_gb if data_transfer_gb <= 10240 else
      (10240 - pricing.data_transfer.free_tier_gb) * pricing.data_transfer.tier_1_per_gb + (data_transfer_gb - 10240) * pricing.data_transfer.tier_2_per_gb if data_transfer_gb <= 51200 else
      (10240 - pricing.data_transfer.free_tier_gb) * pricing.data_transfer.tier_1_per_gb + (51200 - 10240) * pricing.data_transfer.tier_2_per_gb + (data_transfer_gb - 51200) * pricing.data_transfer.tier_3_per_gb if data_transfer_gb <= 153600 else
      (10240 - pricing.data_transfer.free_tier_gb) * pricing.data_transfer.tier_1_per_gb + (51200 - 10240) * pricing.data_transfer.tier_2_per_gb + (153600 - 51200) * pricing.data_transfer.tier_3_per_gb + (data_transfer_gb - 153600) * pricing.data_transfer.tier_4_per_gb
    output: transfer_cost
    pricing_keys:
      - data_transfer.free_tier_gb
      - data_transfer.tier_1_per_gb
      - data_transfer.tier_2_per_gb
      - data_transfer.tier_3_per_gb
      - data_transfer.tier_4_per_gb

total_formula: storage_cost + put_cost + get_cost + transfer_cost

assumptions:
  - "Storage class pricing varies by region"
  - "First 100 GB/month data transfer OUT is free"
  - "Data transfer IN is always free"
  - "Tiered pricing applies to data transfer OUT"
  - "Cross-region replication costs not included"

pricing_sources:
  - name: "AWS S3 Pricing"
    url: "https://aws.amazon.com/s3/pricing/"
    last_updated: "2024-12-15"
