service: AmazonS3
version: "1.0.0"

inputs:
  - name: storage_gb
    type: number
    required: true
    description: "Total storage in GB"
    
  - name: storage_class
    type: string
    required: true
    description: "S3 storage class"
    
  - name: put_requests_per_month
    type: integer
    required: true
    description: "Number of PUT/POST requests per month"
    
  - name: get_requests_per_month
    type: integer
    required: true
    description: "Number of GET requests per month"
    
  - name: data_transfer_gb
    type: number
    required: false
    default: 0
    description: "Data transfer out to internet (GB/month)"

calculation_steps:
  - id: storage_cost
    description: "Storage cost based on storage class"
    formula: storage_gb * (0.023 if storage_class == "STANDARD" else 0.023 if storage_class == "INTELLIGENT_TIERING" else 0.0125 if storage_class == "STANDARD_IA" else 0.01 if storage_class == "ONEZONE_IA" else 0.004 if storage_class == "GLACIER_INSTANT" else 0.0036 if storage_class == "GLACIER_FLEXIBLE" else 0.00099 if storage_class == "GLACIER_DEEP_ARCHIVE" else 0.023)
    output: storage_cost
    
  - id: put_request_cost
    description: "PUT/POST request costs ($0.005 per 1,000 PUT requests)"
    formula: (put_requests_per_month / 1000) * 0.005
    output: put_cost
    
  - id: get_request_cost
    description: "GET request costs ($0.0004 per 1,000 GET requests)"
    formula: (get_requests_per_month / 1000) * 0.0004
    output: get_cost
    
  - id: data_transfer_cost
    description: "Data transfer out to internet (tiered pricing, first 10GB free)"
    formula: 0 if data_transfer_gb <= 10 else (data_transfer_gb - 10) * 0.09 if data_transfer_gb <= 10000 else (10000 - 10) * 0.09 + (data_transfer_gb - 10000) * 0.085 if data_transfer_gb <= 50000 else (10000 - 10) * 0.09 + (50000 - 10000) * 0.085 + (data_transfer_gb - 50000) * 0.07
    output: transfer_cost
    
  - id: intelligent_tiering_monitoring
    description: "Monitoring cost for Intelligent-Tiering ($0.0025 per 1,000 objects)"
    formula: ((storage_gb * 100) / 1000) * 0.0025 if storage_class == "INTELLIGENT_TIERING" else 0
    output: monitoring_cost

total_formula: "storage_cost + put_cost + get_cost + transfer_cost + monitoring_cost"

assumptions:
  - "Pricing based on us-east-1 region"
  - "First 10 GB of data transfer out is free per month"
  - "Estimated 100 objects per GB for Intelligent-Tiering monitoring"
  - "No retrieval costs for Glacier classes"
  - "No cross-region replication costs"

pricing_sources:
  - name: "Amazon S3 Pricing"
    url: "https://aws.amazon.com/s3/pricing/"
    last_updated: "2024-01-01"
