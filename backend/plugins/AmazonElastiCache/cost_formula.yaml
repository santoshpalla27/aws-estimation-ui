service: AmazonElastiCache
version: "2.0.0"

inputs:
  - name: engine
    type: string
    required: true
    default: "Redis"
    description: "Cache engine (Redis or Memcached)"
  - name: node_type
    type: string
    required: true
    default: "cache.t3.micro"
    description: "Node type"
  - name: number_of_nodes
    type: integer
    required: true
    default: 1
    description: "Number of cache nodes"
  - name: backup_storage_gb
    type: number
    required: false
    default: 0
    description: "Backup storage in GB (Redis only)"

calculation_steps:
  - id: node_cost
    description: "Cache node cost based on engine and node type"
    formula: |
      number_of_nodes * pricing.constants.hours_per_month * (
        pricing.redis[node_type] if engine == 'Redis' else pricing.memcached[node_type]
      )
    output: node_cost
    pricing_keys:
      - redis
      - memcached
      - constants.hours_per_month
      
  - id: backup_cost
    description: "Backup storage cost (Redis only)"
    formula: |
      if engine == 'Redis':
        backup_storage_gb * pricing.backup_storage_per_gb
      else:
        0
    output: backup_cost
    pricing_keys:
      - backup_storage_per_gb

total_formula: "node_cost + backup_cost"

assumptions:
  - "Node pricing varies by type and region"
  - "Backup storage applies to Redis only"
  - "Data transfer charged separately"
  - "Multi-AZ doubles node cost"

pricing_sources:
  - name: "Amazon ElastiCache Pricing"
    url: "https://aws.amazon.com/elasticache/pricing/"
    last_updated: "2024-12-15"
